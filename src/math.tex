% The Not So Short Introduction to LaTeX
%
% Copyright (C) 1995--2022 Tobias Oetiker, Marcin Serwin, Hubert Partl,
% Irene Hyna, Elisabeth Schlegl and Contributors.
%
% This document is free software: you can redistribute it and/or modify it
% under the terms of the GNU General Public License as published by the Free
% Software Foundation, either version 3 of the License, or (at your option) any
% later version.
%
% This document is distributed in the hope that it will be useful, but WITHOUT
% ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
% FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
% details.
%
% You should have received a copy of the GNU General Public License along with
% this document.  If not, see <https://www.gnu.org/licenses/>.

% !TEX root = ./lshort.tex

\chapter{Typesetting Mathematical Formulae}\label{chap:math}

\begin{intro}
  The \TeX{} typesetting system has become nearly ubiquitous when it comes to
  typesetting mathematics. Many projects offer to export its mathematical
  formulae to \LaTeX{} (for example SageMath~\cite{sagemath}) or allow to enter
  them in \LaTeX{} or \LaTeX{}-derived syntax (for example
  Wikipedia~\cite{enwiki:1091087776}). In this chapter you will learn how to
  insert math formulae into your document.
\end{intro}

\section{Modern Mathematics}

While core \LaTeX{} is able to produce high quality mathematics output on its
own, there are some are areas where it is lacking and some of its choices are
rather dated. To overcome these limitations we are going to use two packages:
\pai*{mathtools} and \pai*{unicode-math}.

The \pai*{amsmath} from the \hologo{AmSLaTeX} bundle was originally developed
by The \emph{\wi{American Mathematical Society}} in 1995 to use for their own
publications, but became pretty much indispensable for typesetting any advanced
mathematics in \LaTeX. It extends the command set to easily typeset matrices,
declare custom operators and much more. However the problem with it becoming so
ubiquitous is that changing it would break a lot of old documents, which is
highly undesirable. Fortunately, the \pai{mathtools} package exists---it loads
the \pai{amsmath} fixing some of its undesirable behaviours and provides some
additional commands.

The original \TeX{} used its own font encoding for typesetting mathematics,
which is still used by default in \LaTeX{}. In recent years a new standard
appeared: OpenType math extensions\footnote{Its internal structure is actually
  based on \TeX{} font tables.} which makes it possible to use standardised
Unicode characters inside documents. The \pai{unicode-math} package adds
support for these fonts in \LaTeX{} allowing you to use more symbols and makes
the commands for accessing math symbols a bit more consistent. The problem with
\pai{unicode-math} is the opposite of the \pai{amsmath}---it is a relatively
new player in the game and it changes some of the fundamental \TeX{}
assumptions, so it may not work well with some packages (especially if they're
old). Unfortunately there is no easy way out of this and you may have to give
up either these packages or unicode math fonts.

Throughout this section it is assumed that your preamble contains these two
lines in this order:
\begin{minted}{latex}
\usepackage{mathtools}
\usepackage[
  math-style=ISO,
  warnings-off={mathtools-colon, mathtools-overbracket},
]{unicode-math}
\end{minted}
The \cargv{math-style=ISO} key fixes a small inconsistency in original \TeX{}
regarding the shape of uppercase Greek letters. The \cargv{warnings-off} key
disables two warnings about overwriting some \pai{mathtools}
commands.\footnote{These are \csi{overbracket}, \csi{underbracket},
  \csi{coloneq}, \csi{dblcolon}, \csi{coloneqq}, \csi{Coloneqq} and
  \csi{eqqcolon}. Disable this package option and read these warnings if you are
  going to use them.}

\section{Single Equations}\label{sec:single_equations}

\LaTeX{} distinguishes between two styles of typesetting the formulae:
\emph{\wi{text style}} and \emph{\wi{display style}}. The text style is used
typeset inline math in running text, like this \(\sum_{k=0}^\infty
\frac{1}{k}\), while the display style is used to typeset bigger equations on
their own line, like this
\[
  \sum_{k=0}^\infty \frac{1}{k}.
\]

To typeset inline formulae, put it between \csi{(} and \csi{)} commands, while
\csi{[} and \csi{]} typesets it in display mode.
\begin{chktexignore}  
\begin{example}
Not like this 3-1=0,
but like this \(3-1=2\)
or this
\[
  3 - 1 = 2
\]
\end{example}
\end{chktexignore}

It is often the case that we want to refer to a specific formula or equation in
the book. To make this possible a special \ei{equation} environment exists that
typesets the formula in display mode and adds a number to the right. The
equations can be labelled and refereed to using commands described in
\autoref{sec:crossref}.
\begin{example}
\begin{equation}
  \label{trivial}
  2 + 2 = 4
\end{equation}
The equation~\ref{trivial}
is true.
\end{example}
Two additional commands exist \csi{eqref} and \csi{tag}. The first one is
similar to the \cs{ref} command but encloses its label in parentheses to match
the appearance of the equation label. The second one allows you to customise
the the visible label of the equation.
\begin{example}
\begin{equation}
  \tag{Ingsoc's theorem}
  \label{ingsoc}
  2 + 2 = 5
\end{equation}
The~\eqref{ingsoc} is false.
\end{example}
The starred version, \ei{equation*}, is a synonym of \csi{[}.

\subsection{Math Mode}

The commands and environments mentioned in the previous section enter what's
called \emph{\wi{math mode}}, as opposed to the \emph{text mode} outside them.
There are numerous differences between those. For starters, most of the
whitespaces are ignored in math mode.
\begin{example}
\(123xyz\) is the same as \(
  1 2 3 x y z
\).
\end{example}
The spaces around symbols are derived logically from the mathematical
expressions. We will talk more about those in \autoref{sec:math-spacing}. Since
in math formulae there is no concept of a paragraph leaving empty lines inside
math mode is \emph{not} allowed. Doing so will result in the \enquote{Bad math
  environment delimiter.} error.

Another difference is the fact that all letters are treated as mathematical
variables. This changes their font style to \textit{italic} and changes the
spacing around them.
\begin{example}
Compare office to \(office\).
\end{example}
If you want to typeset normal text within formulae you can use the \csi{text}
command.
\begin{example}
\( 1 + \text{one} = 2\)
\end{example}

Finally, additional commands and syntax become available that allow to typeset
mathematical notation. For example, the \ai{\^{}} and \ai{\_} characters can
now be used to typeset superscript and subscript, respectively.%
\index{subscript}\index{superscript}
\begin{example}
\( a^2 + b^2 = c^2 \) \\
\( A_x = G_{\text{foo}} \)
\end{example}

\section{Building Blocks of a Mathematical Formulae}

In this section, we describe the most important commands used in mathematical
typesetting. The list of symbols introduced here is far from comprehensive. If
you need some additional symbols be sure to check out~\cite{detexify,
  unicode-math-symbols, latexcomp} since there is a high chance it already
exists.

\subsection{Basic Arithmetic}

You can probably guess how to typeset addition, subtraction and equality based
on the previous examples. To typeset multiplication and division symbols you can
use \csi{times} and \csi{div} commands.
\begin{example}
\( (4 \times 6) \div 3 = 8 \)
\end{example}
If you prefer to use dots for multiplication or slash for division you can use
\csi{cdot} and \csi{divslash}, respectively. To typeset negated equality you can
precede the equal sign with \csi{not}.
\begin{example}
\( (5 \cdot 3) \divslash 2
  \not= 7 \)
\end{example}
Alternatively you can use \csi{neq} which will produce the same result. The
\csi{not} notation is more general in that it works with many more symbols.

To typeset weak inequalities you can use the \csi{leq} (less or equal) and
\csi{geq} (greater or equal) commands. If you prefer slanted versions swap them
for \csi{leqslant} and \csi{geqslant}.
\begin{example}
\( 1 \leq 2 \) vs.\ 
\(1 \leqslant 2\)
\end{example}

Exponentiation can be achieved using the superscript \ai{\^{}}\index{exponent}
character, but there are some subtleties. During typesetting, superscript
adapts to the height of the previous character. This is usually correct, but
when dealing with parentheses it may be a bit too low.
\begin{example}
\( a^2 \) is fine, but what
about \( (a^2)^2 \)?
\end{example}
In the example above the second superscript doesn't know about the first one
inside, and it adapts only to the height of the closing parenthesis. To fix
this enclose the parentheses in a group.
\begin{example}
\( {(a^2)}^2 \) is better.
\end{example}
In \autoref{sec:delimiters} we will also talk about growing parentheses that do
not have this problem.

To enter \wi{square root}s use the \csi{sqrt} command. It will automatically
overline the expression it received as the argument.
\begin{example}
From Homer's theorem it 
follows that
\[
  \sqrt{a} + \sqrt{b} = \sqrt{c}
\]
so we can see that
\(c = \sqrt{2x^2+7}\).
\end{example}
The full syntax of the \csi{sqrt} is actually
\begin{lscommand}
  \csi{sqrt}[n: o, expr: m]
\end{lscommand}
The optional argument \carg{n} allows you to typeset \carg{n}-th root
radicals.\footnote{The name \csi{sqrt} is a bit misleading in that respect
  \smiley.}
\begin{example}
Find three positive integers
\(a, b\) and \(c\), such that
\[
  a = \sqrt[7]{b^7 + c^7}
\]
\end{example}

Finally typesetting built-up fractions is made possible by the
\begin{lscommand}
  \csi{frac}[numerator:m, denominator:m]
\end{lscommand}
command.
\begin{example}
And since
\[
  \frac{a}{b} \leq
  \frac{a+c}{b+d} \leq
  \frac{c}{d}
\]
it follows that
\(x = \frac{\sqrt{z+3}}{y^3}\).
\end{example}

\subsection{Logic and Set Theory}

The basic logical operations can be typeset using rather self explanatory
commands: \csi{lnot}, \csi{land}, \csi{lor}, \csi{implies} and \csi{iff}.
\begin{example}
\[
  p \land q \iff 
  \lnot (p \implies \lnot q) 
\]
\end{example}
There's also a left facing implication named \csi{impliedBy}. Some less
established logical symbols can be also found under less intuitive names such
as \csi{veebar} that produces \(\veebar\) used by some for exclusive
disjunction. If you intend to use them make sure to use commands described in
\autoref{sec:new_commands} to create meaningful synonyms.

The quantifiers symbols can be typeset using \csi{forall} and \csi{exists}
commands.
\begin{example}
\[
  \lnot\forall_{q} P(q) \iff
  \exists_{q}\lnot P(q)
\]
\end{example}

To typeset sets use the \csi{\{} and \csi{\}} commands.
\begin{example}
\(\{1, 2, 3, \ldots, 100\}\)
\end{example}
To indicate set membership (\enquote{is element of}) you can use the \csi{in}
command.\footnote{Try to guess its left-flipped version name.} Sets defined by
a predicate are often written using a set-builder notation with a colon. The
naïve way would be to write it like this
\begin{example}
\( \{x \in X:
  \exists_n x^n = 1\} \)
\end{example}
The result doesn't look right though. The reason is the aforementioned
automatic spacing based on mathematical meaning. The \mintinline{latex}|:|
character is used in \LaTeX{} for ratios, such as \(1:2\), which is why it has
equal spacing on both of its sides. To typeset colons in a set-builder notation
use the \csi{colon} command instead.
\begin{example}
\(\{ X \ni x\colon
  \exists_n x^n = 1\} \)
\end{example}

The usual set inclusion symbols are accessible as \csi{subset}, \csi{subseteq}
and \csi{subsetneq}, while their flipped versions are accessible as
\csi{supset}, \csi{supseteq} and \csi{supsetneq}. The set union symbol is
hiding behind \csi{cup} while set intersection is \csi{cap}. Set difference is
just \csi{setminus} though. You may also find \csi{emptyset} useful.
\begin{example}
% TODO: Waiting for unicode-math fix
\RenewDocumentCommand{\setminus}{}{\smallsetminus}
\[
  \emptyset
  \subset X \setminus X
  \subseteq X \cap \emptyset
  \subsetneq X
  \supseteq X \cup X
\]
\end{example}

\subsection{Greek Letters}

Every mathematician knows that Latin alphabet just isn't enough. Accessing the
Greek alphabet is as easy as typing \csi{alpha}, \csi{beta}, \csi{gamma},
\ldots{} for lowercase letters and \csi{Alpha}, \csi{Beta}, \csi{Gamma},
\ldots{} for uppercase letters.%
\csih{alpha}\csih{beta}\csih{gamma}\csih{delta}\csih{epsilon}\csih{zeta}%
\csih{eta}\csih{theta}\csih{iota}\csih{kappa}\csih{lambda}\csih{mu}%
\csih{nu}\csih{xi}\csih{omicron}\csih{pi}\csih{rho}\csih{sigma}\csih{tau}%
\csih{upsilon}\csih{phi}\csih{chi}\csih{psi}\csih{omega}\csih{Alpha}%
\csih{Beta}\csih{Gamma}\csih{Delta}\csih{Epsilon}\csih{Zeta}\csih{Eta}%
\csih{Theta}\csih{Iota}\csih{Kappa}\csih{Lambda}\csih{Mu}\csih{Nu}\csih{Xi}%
\csih{Omicron}\csih{Pi}\csih{Rho}\csih{Sigma}\csih{Tau}\csih{Upsilon}%
\csih{Phi}\csih{Chi}\csih{Psi}\csih{Omega}
\begin{example}
Let \(\epsilon\) be a small
number and let  \(\Epsilon\)
be a large number.
\end{example}
As you can see above in most fonts (including the default \LaTeX{} one) there
is no visual difference between some uppercase Greek letters and their Latin
equivalents. If you want to use them, make sure they do not clash in your
document.

Some Greek letters have defined variants. These are accessible by prepending
the word \texttt{var} before the letter name, for example \csi{varepsilon}. A
list of all defined variants is presented in \autoref{tbl:greek_variants}.
\begin{table}
  \ExplSyntaxOn
  \NewDocumentCommand{\VariantShowcase}{m}{
    \csi{var#1} & \(\use:c{var#1}\) & \(\use:c{#1}\)
  }
  \ExplSyntaxOff
  \caption{Available variants of Greek letters.}\label{tbl:greek_variants}
  \begin{tabular}{@{}lcc@{}}
    \toprule
    Command & Variant & Main  \\
    \midrule
    \VariantShowcase{epsilon} \\
    \VariantShowcase{kappa}   \\
    \VariantShowcase{phi}     \\
    \VariantShowcase{pi}      \\
    \VariantShowcase{rho}     \\
    \VariantShowcase{sigma}   \\
    \VariantShowcase{theta}   \\
    \VariantShowcase{Theta}   \\
    \bottomrule
  \end{tabular}
\end{table}

Note that all of the Greek letters in math mode, similarly to Latin letters,
are considered to be mathematical variables. In particular \csi{pi}
\emph{should not} be used to denote the famous constant.

\subsection{Mathematical Fonts and How To Use Them}

When writing mathematics it is often the case that we use different fonts for
mathematical symbols depending on the object they represent. For example the
variables are typeset using the italic font, while known sets often get
a fancy double-struck ((also known as \enquote*{blackboard bold})) font, for example \(\symbb{N}\). You can access various fonts by using
the family of \cs{sym...} commands. For example to typeset double-struck
letters use the \csi{symbb} command.
\begin{example}
\[
  \forall_{p \in \symbb{P}}
  \exists_{n \in \symbb{N}}
  p < 5 \lor p = 24n + 1
\]
\end{example}
All font changing commands are listed in \autoref{tbl:sym_commands}.
\begin{table}
  \ExplSyntaxOn
  \NewDocumentCommand{\Ncmmr}{m}{
    \setmathfont{New Computer Modern Math Regular}
    #1
    \setmathfont{Latin Modern Math}
  }

  \NewDocumentCommand{\LStr}{}{ABCabc\ \ldots}
  \NewDocumentCommand{\GStr}{}{
    \Alpha\Beta\Gamma\alpha\beta\gamma\ \ldots}
  \NewDocumentCommand{\NStr}{}{123\ \ldots}
  \ExplSyntaxOff
  \caption{Commands that change the font of mathematical symbols. Empty
    example field indicates that the Unicode does not define glyphs in the
    given set.}\label{tbl:sym_commands}
  \begin{minipage}{\linewidth}
    \centering
    \begin{tabular}{@{}*4l@{}}
      \toprule
                      & \multicolumn{3}{c}{Example}                                                           \\
      \cmidrule(l){2-4}
      Command         & Latin                        & Greek                          & Numerals              \\
      \midrule

      \csi{symup}     & \(\symup{\LStr}\)            & \(\symup{\GStr}\)              & \(\symup{\NStr}\)     \\
      \csi{symbfup}   & \(\symbfup{\LStr}\)          & \(\symbfup{\GStr}\)            & \(\symbfup{\NStr}\)   \\
      \csi{symit}     & \(\symit{\LStr}\)            & \(\symit{\GStr}\)              &                       \\
      \csi{symbfit}   & \(\symbfit{\LStr}\)          & \(\symbfit{\GStr}\)            &                       \\
      \csi{symsfup}   & \(\symsfup{\LStr}\)          &                                & \(\symsfup{\NStr}\)   \\
      \csi{symbfsfup} & \(\symbfsfup{\LStr}\)        & \(\symbfsfup{\GStr}\)          & \(\symbfsfup{\NStr}\) \\
      \csi{symsfit}   & \(\symsfit{\LStr}\)          &                                &                       \\
      \csi{symbfsfit} & \(\symbfsfit{\LStr}\)        & \(\symbfsfit{\GStr}\)          &                       \\
      \csi{symtt}     & \(\symtt{\LStr}\)            &                                & \(\symtt{\NStr}\)     \\
      \csi{symbb}\footnote{
        In Greek set only the four presented glyphs (\cs{Gamma}, \cs{Pi},
        \cs{gamma} and \cs{pi}) are defined by the Unicode standard.
      }               & \(\symbb{\LStr}\)            & \(\symbb{\Gamma\Pi\gamma\pi}\) & \(\symbb{\NStr}\)     \\
      \csi{symbbit}\footnote{
        Only the five presented glyphs (\texttt{D}, \texttt{d}, \texttt{e},
        \texttt{i} and \texttt{j}) are defined by the Unicode standard.
      }               & \(\symbbit{Ddeij}\)          &                                &                       \\
      \csi{symscr}\footnote{
        The default font does not contain lowercase glyphs. Here they are shown
        using a different font.
      }               & \Ncmmr{\(\symscr{\LStr}\)}   &                                &                       \\
      \csi{symbfscr}\footnote{
        Same as above.
      }               & \Ncmmr{\(\symbfscr{\LStr}\)} &                                &                       \\
      \csi{symfrak}   & \(\symfrak{\LStr}\)          &                                &                       \\
      \csi{symbffrak} & \(\symbffrak{\LStr}\)        &                                &                       \\
      \bottomrule
    \end{tabular}
  \end{minipage}
\end{table}

Avoid writing these commands directly in your formulas, you should create
logical wrappers around them. For example, the
\citetitle{iso80000-2}~\cite{iso80000-2} standard states that mathematical
constants should be written in a Roman (upright) font. Writing
\mintinline{latex}|\symrm{e}| every time we want to refer to the base of
natural logarithm will make the code less readable, so below we create simple
wrappers for the constants we are going to use.
\begin{example}[vertical_mode, examplewidth=0.7\linewidth]
\NewDocumentCommand{\e}{}{\symrm{e}}
\NewDocumentCommand{\im}{}{\symrm{i}}
\NewDocumentCommand{\cpi}{}{\symrm{\pi}}
\[ \e^{\im\cpi} + 1 = 0 \]
\end{example}

Known functions such as \(\sin\) or \(\log\) should also be written in Roman,
however you should not use the \csi{symrm} command to do so. As the name of the
command indicates, it is meant to be used for mathematical symbols. Since in
\(\sin\) name \(s\), \(i\) and \(n\) are not symbols, but a components of a
single operator name, there are separate commands for typesetting these.
Fortunately you do not have to access them directly since many of the standard
functions are already defined.
\begin{example}
\NewDocumentCommand{\cpi}{}{\symrm{\pi}} %!hide
\NewDocumentCommand{\e}{}{\symrm{e}} %!hide
\( \cos(2\cpi) = \ln(\e) \)
\end{example}
The full list of predefined functions is presented in \autoref{tbl:functions}.
\begin{table}
  \caption{All functions predefined by \LaTeX{}.}\label{tbl:functions}
  \begin{tabular}{llllll}
    \toprule
    \csi{arccos} & \csi{cos}  & \csi{csc} & \csi{exp}  & \csi{ker}    & \csi{limsup} \\
    \csi{arcsin} & \csi{cosh} & \csi{deg} & \csi{gcd}  & \csi{lg}     & \csi{ln}     \\
    \csi{arctan} & \csi{cot}  & \csi{det} & \csi{hom}  & \csi{lim}    & \csi{log}    \\
    \csi{arg}    & \csi{coth} & \csi{dim} & \csi{inf}  & \csi{liminf} & \csi{max}    \\
    \csi{sinh}   & \csi{sup}  & \csi{tan} & \csi{tanh} & \csi{min}    & \csi{Pr}     \\
    \csi{sec}    & \csi{sin}                                                         \\
    \bottomrule
  \end{tabular}
\end{table}

If these are not enough for you, use the \csi{DeclareMathOperator} command to
define your own. It can be only used in the preamble.
\begin{example}[vertical_mode, examplewidth=0.6\linewidth]
%!showbegin !hide
% In preamble
\DeclareMathOperator{\argh}{argh}
% ...
%!showend !hide
\[ \argh(x) = \sinh(\max(x, x^2)) \]
\end{example}

\subsection{Big Operators}

At the beginning of the \autoref{sec:single_equations} we have shown the
summation operator to show off capabilities of mathematical typesetting. To
typeset it use the \csi{sum} command. Its lower and upper limits are specified
by the sub- and superscript operators.
\begin{example}
\(
  \sum_{k=0}^{n} \frac{1}{k^2}
\)
\end{example}
As you saw its appearance in text style starkly differs from the one in the
display style.
\begin{example}
\[
  \sum_{k=0}^{n} \frac{1}{k^2}
\]
\end{example}

This is an example of what's commonly known as big operator. There are other
such operators, such as \csi{prod} for products, or \csi{bigwedge} for
conjunctions. Some of the functions listed in \autoref{tbl:functions} are also
big operators.
\begin{example}
\[
  c = \max_{x\in X} f(x)
\]
\end{example}

You can define your own big operators by using a starred version of the
\csi{DeclareMathOperator} command.
\begin{example}[vertical_mode, examplewidth=0.6\linewidth]
%!showbegin !hide
% In preamble
\DeclareMathOperator*{\nut}{Nut}
% ...
%!showend !hide
\[ \nut_y = \lim_{x \to y} \argh{x} \]
\end{example}

If you have a long limit, it may make sense to typeset it vertically instead of
horizontally. This can be done using the \csi{substack} command. Inside you can
place \cs{\bs} to indicate where new lines should be started.
\begin{example}
\[
  \sum^n_{
    \substack{0<i<n \\ 
    j\subseteq i}
  }
   P(i,j) = Q(i,j)
\]
\end{example}

Integral symbol is also a big operator, but it only shifts the lower limit left.
\begin{example}
\[
  \int_a^b \liminf_{a \to x} a^2
\]
\end{example}
Due to the fact that the symbol is very slanted to the right,
typesetting multiple integrals leads to excessive space around them. You
should use \csi{iint},\csi{iiint},\csi{iiiint} if you want to typeset them.
\begin{example}
\[ \int\int\int\int \]
vs.\ 
\[ \iiiint \]
\end{example}

If you want to suppress the big operators limits and typeset normal sub- or
supscript next to them, you can simply surround them with curly braces.
\begin{example}
\[
  {\sum_{a}}^b
  \qquad%!hide
  {\int}_a^b
  \qquad%!hide
  {\nut^b}_a
\]
\end{example}
However if a long long limit is present this may lead to excessive spacing
before the sub- or supscripts.
\begin{example}
\[ {\sum_{loooooong}}^{b} \]
\end{example}
To fix the issue use the
\begin{lscommand}
  \csi{sideset}[left: m, right: m, symbol: m]
\end{lscommand}
command. It surrounds the \carg{symbol} with left and right commands before
typesetting its limits.
\begin{example}[vertical_mode, examplewidth=0.7\linewidth]
\[ \sideset{^{a}}{^{b}}{\sum}_{loooooong} \]
\end{example}

\subsection{Math Accents}

To denote arithmetic mean taken over a variable, a notation with a bar over the
variable is used: \(\bar x\). If you remember the \autoref{accents} from
\autopageref{accents} you may think that it would be possible to write it as
\mintinline{latex}|\=x|. This will not work though. In fact none of the
commands from this table will work in math mode. There is a good conceptual
reason for that---the accents listed there are meant to typeset non-Latin
letters that are used in various languages. The character
\mintinline{latex}|\"u| is meant to represent u-umlaut and the correct glyph
for it will be chosen if it exists in the current font. In math we don't want
an u-umlaut---we want \enquote{double dot above} operator applied to variable
\(u\), thus different commands are used to achieve that.

To actually get a bar over a variable you can use the \csi{bar} command. Other
accents\index{mathematical!accents} include \csi{hat}, \csi{grave},
\csi{acute}, \csi{tilde} or \csi{ddot}. Refer to~\cite{unicode-math-symbols}
for a full list.
\begin{example}
\(\bar{x}\) \(\hat{x}\)
\(\grave{x}\) \(\acute{x}\)
\(\tilde{x}\) \(\ddot{x}\)
\end{example}

Some accents also exist in a \enquote*{wide} version. These can encompass more
than one character. Compare \csi{hat} to \csi{widehat} in the example below.
\begin{example}
\(\hat{ABC}\) vs.\
\(\widehat{ABC}\)
\end{example}
The wide version of \csi{bar} accent is called \csi{overline}. It is useful if
you want to mark the repetend of a decimal fraction.
\begin{example}
\(0.123\overline{456789}\)
\end{example}

Some wide accents even have limits. For example, the \csi{overbrace} and
\csi{underbrace} commands enable you to create horizontal braces with an
expression above or below them.
\begin{example}
\[
  \underbrace{
    \overbrace{(a+b+c)}^6 
    \times
    \overbrace{(d+e+f)}^7
  }_{\text{meaning of life}}=42
\]
\end{example}

If the default accents are not enough for you you can create your own using
\csi{overset} and \csi{underset}.
\begin{example}
\(\overset{\text{foo}}{x}\)
\(\underset{\times}{A}\)
\end{example}
These commands may also be used when creating custom \wi{binary relations},
though you may check whether the one you are trying to define is not already predefined.
\begin{example}
\(a \overset{\text{def}}{=} b\)
vs.\ \(a \eqdef b\)
\end{example}

\subsection{Delimiters}\label{sec:delimiters}

Besides the standard parentheses, brackets and braces, \LaTeX{} provides all
sorts of symbols for \wi{delimiters}, such as
\begin{example}
\[
  \langle x \rangle
  \; %!hide
  \lBrack x \rBrack 
  \; %!hide
  \lfloor x \rfloor
  \; %!hide
  \lvert x \rvert
\]
\end{example}
While all of them work fine for small input, things get ugly when the
expression inside them starts getting tall.
\begin{example}[vertical_mode, examplewidth=0.8\linewidth]
\[
  {\lfloor
    \frac
    {{\langle\sum_{k=1}^{\infty} k^{-4}\rangle}^3}
    {\frac{{\lvert\{a,b,c\}\rvert}^8}{{(x^4)}^3}}
  \rfloor}^6
\]
\end{example}

To fix this you can use the \csi{left} and \csi{right} commands. These take one
argument---the delimiter to extend---and adapt its size based on the content
they delimit. You must close every \csi{left} with a corresponding \csi{right}
but they do not have to use the same delimiter.
\begin{chktexignore}
\begin{example}
\[
  \left(
    \frac{1}{1 +
      \frac{1}{1 +
        \frac{1}{1 +
          \frac{1}{1 +
            \ldots}}}}
  \right]
\]
\end{example}
\end{chktexignore}
If you want to typeset delimiter only on one side of the expression, a special
value may be passed: the dot character \ai{.}, which is treated as an invisible
delimiter.
\begin{example}
\[
  x = \left.
    \sum_{k=1}^{\infty}
      \frac{1}{k^2}
  \right\}
\]
\end{example}

While using the \csi{left} and \csi{right} commands directly is sometimes
necessary, the simplest case of using some predefined delimiters on both sides
is the most common. For this usage the command
\begin{lscommand}
  \csi{DeclarePairedDelimiter}[name: M, left delim: m, right delim: m]
\end{lscommand}
is really useful. It declares the \carg{name} command which simply encloses its
argument between \carg{left delim} and \carg{right delim}, while its starred
version additionally uses \csi{left} and \csi{right} commands when typesetting
delimiters.
\begin{chktexignore}
\begin{example}[vertical_mode, examplewidth=0.8\linewidth]
\DeclarePairedDelimiter{\set}{\{}{\}}
\DeclarePairedDelimiter{\size}{\lvert}{\rvert}
\DeclarePairedDelimiter{\mean}{\langle}{\rangle}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\parens}{(}{)}
\[
  \floor*{
    \frac
    {\mean*{\sum_{k=1}^{\infty} k^{-4}}^3}
    {\frac{\size*{\set{a,b,c}}^8}{\parens*{x^4}^3}}
  }^6
\]
\end{example}
\end{chktexignore}

In some special circumstances you may also want to select the size of the
delimiter yourself. You can do this using  \csi{big}, \csi{Big}, \csi{bigg} and
\csi{Bigg} commands. These may be either prepended to delimiting symbol with
\enquote{l} and \enquote{r} suffixes or passed as an optional argument to a
declared delimiter.
\begin{chktexignore}
  \begin{example}
\DeclarePairedDelimiter{%
  \set}{\{}{\}}
\( \bigl[ \ddagger \Biggr) \)
\quad %!hide
\( \set[\Big]{1,\frac{3}{4}} \)
\end{example}
\end{chktexignore}

If the \csi{DeclarePairedDelimiter} is not enough for you, there also exists
more powerful \csi{DeclarePairedDelimiterX}, which is described in the
documentation of \pai*{mathtools} package.

\section{Single Equations that are Too Long: multline}%
\index{long equations}\label{sec:multline}

If an equation is too long, we have to wrap it somehow. Unfortunately,
wrapped equations are usually less easy to read than not wrapped
ones. To improve the readability, there are certain rules on how to do
the wrapping:
\begin{enumerate}
  \item In general one should always wrap an equation \emph{before} an
        equality sign or an operator.
  \item A wrap before an equality sign is preferable to a wrap before
        any operator.
  \item A wrap before a plus- or minus-operator is preferable to a wrap
        before a multiplication-operator.
  \item Any other type of wrap should be avoided if at all possible.
\end{enumerate}
The easiest way to achieve such a wrapping is the use of the
\ei{multline} en\-vi\-ron\-ment:\footnote{The
  \ei{multline} environment is from \pai{amsmath}.}
\begin{example}
\begin{multline}
  a + b + c + d + e + f 
  + g + h + i  
  \\
  = j + k + l + m + n 
\end{multline}
\end{example}
\noindent
The difference from the \ei{equation} environment is that an arbitrary
line-break (or also multiple line-breaks) can be introduced. This is
done by putting a \csi{\bs} on those places where the equation needs
to be wrapped. Similarly to \ei{equation*} there also exists a
\ei{multline*} version for preventing an equation number.

Often the
\ei{IEEEeqnarray} environment (see \autoref{sec:IEEEeqnarray})
will yield better results.  Consider the following
situation:
\begin{example}
\begin{equation}
  a = b + c + d + e + f 
  + g + h + i + j 
  + k + l + m + n + o + p  
  \label{eq:equation_too_long}
\end{equation}
\end{example}
\noindent
Here it is actually the RHS that is too long to fit on one line. The
\ei{multline} environment creates the following output:
\begin{example}
\begin{multline}
  a = b + c + d + e + f 
  + g + h + i + j \\
  + k + l + m + n + o + p
\end{multline}
\end{example}

This is better than~\eqref{eq:equation_too_long}, but
it has the disadvantage that the equality sign loses its natural
greater importance with respect to the plus operator in front of
$k$. The better solution is provided by the
\ei{IEEEeqnarray} environment that will be discussed in detail in
\autoref{sec:IEEEeqnarray}.

\section{Multiple Equations}%
\index{equation!multiple}\label{sec:IEEEeqnarray}

In the most general situation we have a sequence of several
equalities that do not fit onto one line. Here we need to work with
vertical alignment in order to keep the array of equations in a nice
and readable structure.

Before we offer our suggestions on how to do this, we start with a few
bad examples that show the biggest drawbacks of some common solutions.

\subsection{Problems with Traditional Commands}%
\label{sec:problems_traditional}

To group multiple equations the
\ei{align} environment\footnote{The \ei{align} environment can
  also be used to group several blocks of equations beside each other.
  Another excellent use case for the
  \ei{IEEEeqnarray} environment. Try an argument like
  \cargv{\{rCl+rCl\}}.} could be used:
\begin{example}
\begin{align}
  a & = b + c \\
  & = d + e
\end{align}
\end{example}
this approach fails once a single line is too long:
\begin{example}
\begin{align}
  a & = b + c \\
  & = d + e + f
  + g + h + i \nonumber \\
  & + j + k + l \\
  & = m + n + o + p
\end{align}
\end{example}
Here $+\:m$ should be below $d$ and not below the equality sign. A
\TeX{}pert will point out that \mintinline{latex}|\mathrel{\phantom{=}} \negmedspace{}|,
would add the necessary space in front of \verb|+m+n+o|, but since most users
lack that kind of imagination, a simpler solution would be nice.

This is the moment where the \ei{eqnarray} environment bursts onto the scene:
\begin{example}
\begin{eqnarray}
  a & = & b + c \\
  & = & d + e + f
  + g + h + i \nonumber \\
  && +\: j + k + l \\
  & = & m + n + o + p
\end{eqnarray}
\end{example}

It is better but still not optimal. The spaces around the equality signs are too big.
Particularly, they are \emph{not} the same as in the
\ei{multline} and \ei{equation} environments:
\begin{example}
\begin{eqnarray}
  a & = & a = a
\end{eqnarray}
\end{example}

\noindent \ldots and the expression sometimes overlaps with the equation number even
though there would be enough room on the left:
\begin{example}
\begin{eqnarray}
  a & = & b + c 
  \\
  & = & d + e + f + g + h^2 
  + i^2 + j 
  \label{eq:faultyeqnarray}
\end{eqnarray}
\end{example}

\noindent While the environment offers a command \csi{lefteqn} that can
be used when the LHS is too long:
\begin{example}
\begin{eqnarray}
  \lefteqn{a + b + c + d 
    + e + f + g + h}\nonumber\\
  & = & i + j + k + l + m 
  \\
  & = & n + o + p + q + r + s
\end{eqnarray}
\end{example}
\noindent This is not optimal either as the RHS is too short and the array is
not properly centred:
\begin{example}
\begin{eqnarray}
  \lefteqn{a + b + c + d 
    + e + f + g + h} 
  \nonumber \\
  & = & i + j 
\end{eqnarray}
\end{example}

\noindent Having badmouthed the competition sufficiently, I can now steer you gently towards the glorious \ldots

\subsection{IEEEeqnarray Environment}%
\label{sec:IEEEeqnarray_intro}

The \ei{IEEEeqnarray} environment is a very powerful command with
many options. Here, we will only introduce its basic
functionalities. For more information please refer to the
manual.\footnote{For the official manual see~\cite{IEEEtran_HOWTO}.
  The part about \texttt{IEEEeqnarray}
  can be found in Appendix~F.}

First of all, in order to be able to use the
\ei{IEEEeqnarray} environment one needs to load the
package\footnote{The \pai{IEEEtrantools} package may not be included in your setup, it can be found on CTAN.}
\pai*{IEEEtrantools}. Include the following line in the header of
your document: \small
\begin{minted}{latex}
\usepackage{IEEEtrantools}
\end{minted}
\normalsize

The strength of \ei{IEEEeqnarray} is the ability to specify
the number of \emph{columns} in the equation array. Usually, this
specification will be \cargv{\{rCl\}}, i.e., three columns, the
first column right-justified, the middle one centred with a little
more space around it (therefore we specify capital \cargv{C} instead of
lower-case \cargv{c}) and the third column left-justified:
\begin{example}
\begin{IEEEeqnarray}{rCl}
  a & = & b + c 
  \\
  & = & d + e + f + g + h 
  + i + j + k \nonumber\\
  && \negmedspace{} + l 
  + m + n + o 
  \\
  & = & p + q + r + s
\end{IEEEeqnarray}
\end{example}
Any number of columns can be specified:
\verb+{c}+ will give only one column with all entries centred, or
\verb+{rCll}+ would add a fourth, left-justified column to use
for comments. Moreover, beside \cargv{l}, \cargv{c}, \cargv{r}, \cargv{L},
\cargv{C}, \cargv{R} for math mode entries there are also \cargv{s},
\cargv{t}, \cargv{u} for left, centred, and right text mode entries.
Additional space can be added with \cargv{.} and
\cargv{/} and \cargv{?} in increasing order.\footnote{For more spacing
  types refer to \autoref{sec:putting-qed-right}.}
Note the spaces around the equality signs in contrast to the space produced
by the \ei{eqnarray} environment.

\subsection{Common Usage}%
\label{sec:common-usage}

In the following we will describe how we use \ei{IEEEeqnarray} to
solve the most common problems.

If a line overlaps with the equation number as in%
~\eqref{eq:faultyeqnarray}, the command
\small
\begin{minted}{latex}
\IEEEeqnarraynumspace
\end{minted}
\normalsize
can be used: it has to be added in the corresponding line and makes
sure that the whole equation array is shifted by the size of the
equation numbers (the shift depends on the size of the number!):
instead of
\begin{example}
\begin{IEEEeqnarray}{rCl}
  a & = & b + c 
  \\
  & = & d + e + f + g + h + i
  \\
  & = & j + k + l + m + n.
\end{IEEEeqnarray}
\end{example}
we get
\begin{example}
\begin{IEEEeqnarray}{rCl}
  a & = & b + c 
  \\
  & = & d + e + f + g + h + i
  \IEEEeqnarraynumspace\\
  & = & j + k + l + m + n.
\end{IEEEeqnarray}
\end{example}

If the LHS is too long, as a replacement for the faulty
\csi{lefteqn} command, \ei{IEEEeqnarray} offers the
\csi{IEEEeqnarraymulticol} command which works in all situations:
\begin{example}
\begin{IEEEeqnarray}{rCl}
  \IEEEeqnarraymulticol{3}{l}{
    a + b + c + d + e + f 
    + g + h
  }\nonumber\\ \quad
  & = & i + j 
  \\
  & = & k + l + m
\end{IEEEeqnarray}
\end{example}
The usage is identical to the \csi{multicolumns} command in the
\ei{tabular} environment. The first argument \cargv{\{3\}}
specifies that three columns shall be combined into one which will be
left-justified \carg{\{l\}}.

Note that by inserting \csi{quad} commands one can easily adapt
the depth of the equation signs,\footnote{I think that one quad is the
  distance that looks good for most cases.} e.g.,
\begin{example}
\begin{IEEEeqnarray}{rCl}
  \IEEEeqnarraymulticol{3}{l}{
    a + b + c + d + e + f 
    + g + h
  }\nonumber\\ \qquad\qquad
  & = & i + j
  \\
  & = & k + l + m
\end{IEEEeqnarray}
\end{example}

If an equation is split into two or more lines, \LaTeX{}
interprets the first $+$ or $-$ as a sign instead of operator.
Therefore, it is necessary to add an empty group \verb|{}| before the operator: instead of
\begin{example}
\begin{IEEEeqnarray}{rCl}
  a & = & b + c 
  \\
  & = & d + e + f + g + h 
  + i + j + k \nonumber\\
  && + l + m + n + o 
  \\
  & = & p + q + r + s
\end{IEEEeqnarray}
\end{example}
we should write
\begin{example}
\begin{IEEEeqnarray}{rCl}
  a & = & b + c 
  \\
  & = & d + e + f + g + h 
  + i + j + k \nonumber\\
  && \negmedspace{} + l 
  + m + n + o 
  \\
  & = & p + q + r + s
\end{IEEEeqnarray}
\end{example}
\noindent Note the space difference between $+$ and $l$!
The construction \verb|{} + l| forces the \verb|+|-sign to be an operator rather
than just a sign, and the unwanted ensuing space between
\verb|{}| and \verb|+| is compensated by a negative medium space
\csi{negmedspace}.

If a particular line should not have an equation number, the
number can be suppressed using \csi{nonumber} (or
\csi{IEEEnonumber}). If on such a line a label
\csi{label}[\ldots: m] is defined, then this label is passed on
to the next equation number that is not suppressed. Place the labels right before the line-break
\csi{\bs} or the next to the equation it belongs to. Apart from
improving the readability of the source code this prevents a
compilation error when a \csi{IEEEmulticol} command
follows the label-definition.

There also exists a starred version where all equation numbers are
suppressed. In this case an equation number can be made to appear
using the command \csi{IEEEyesnumber}:
\begin{example}
\begin{IEEEeqnarray*}{rCl}
  a & = & b + c \\
  & = & d + e \IEEEyesnumber\\
  & = & f + g
\end{IEEEeqnarray*}
\end{example}

Sub-numbers are also easily possible using
\csi{IEEEyessubnumber}:
\begin{example}
\begin{IEEEeqnarray}{rCl}
  a & = & b + c 
  \IEEEyessubnumber\\
  & = & d + e 
  \nonumber\\
  & = & f + g 
  \IEEEyessubnumber  
\end{IEEEeqnarray}
\end{example}

\section{Units}\label{sec:units}\index{units (SI)}\index{SI}

When dealing with real world data you will often find yourself writing units
such as \qty{10}{\kg} or \qty{25}{\coulomb\per\mole}. In technical writing it
is crucial to accurately convey values to avoid errors and ambiguity.
The \emph{International System of Units} (\emph{SI})~\cite{si}, comes with a detailed set
of typesetting rules. For example you may have noticed that in the
first sentence the space between \num{10} and \unit{\kg} is smaller than
between the words.

Fortunately thanks to the logical nature of \LaTeX{} markup and the excellent
\pai*{siunitx} package you do not need to know most of the rules. Just use the special unit-commands provided by the package and all the units in your document will be
typeset correctly.

\subsection{Pitfalls of naïvely entered units}

Naïvely, one might write units like this:
\begin{example}
The speed of light
is 299792458 m/s.
\end{example}
This may look fine initially but if your document gets longer you will probably
get into a situation where an unfortunate linebreak occurs.
\begin{example}
\ldots{} The speed of light
is 299792458 m/s. Thus we
can calculate \ldots
\end{example}
A non-breaking space will fix this problem, but the next one is already waiting---the space between numbers. Digits of
long numbers should be grouped to make them easier to read. The above example
should then written like this:
\begin{example}
The speed of light is
299\,792\,458~m/s.
\end{example}
Yet another problem arises when trying to write the units inside math
mode
\begin{example}
$10~\frac{m}{s}
  \cdot 12~s = 120~m$
\end{example}
Here we need to make sure that the units are written in roman font.
The above example should be then written as
\begin{example}
$10~\frac{\mathrm{m}}
  {\mathrm{s}} 
  \cdot 12~\mathrm{s} 
  = 120~\mathrm{m}$
\end{example}
\noindent Hopefully these examples illustrate why a better method is needed.

\subsection{Basic commands of the \pai{siunitx} package}

The basic commands of \pai{siunitx} package are
\begin{lscommand}
  \csi{num}[options: o, number: m]\\
  \csi{unit}[options: o, unit: m]\\
  \csi{qty}[options:o ! number:m ! unit:m]
\end{lscommand}
The \csi{num} command typesets a number, \csi{unit} typesets a unit, and \csi{qty}
typesets a quantity, i.e.\ a number followed by a unit. All of the commands
provide optional \carg{options} argument, which is a comma delimited key-value pair
list that can influence the output of the command. The \carg{unit} argument can
be provided in one of two styles, either \enquote{literal} or
\enquote{interpreted}.

In literal mode units are entered as string of letters
\begin{example}
\unit{kg} is a unit,
\qty{10}{m/s} is a quantity
\end{example}
Spaces in literal mode are ignored. If you want to insert a product of units,
use either dot \ai{.} or tilde \ai{\~{}}.
\begin{example}
\unit{N} is 
not \unit{kg m / s^2},
but \unit{kg.m / s^2}
or \unit{kg~m / s^2}
\end{example}

On the other hand, in interpreted mode units are entered using predefined
macros
\begin{example}
\unit{\kilo\gram} is a unit,
\qty{10}{\metre\per\second}
is a quantity
\end{example}
At first glance this may seem less convenient, but this enables the package to
recognise the logical structure of the units, which means that the formatting
can be changed on the fly.
\begin{example}[examplewidth=0.8\linewidth, vertical_mode]
Which one do you prefer:
$\unit{\newton} = \unit{
  \kilo\gram\metre\per\square\second}$,
$\unit{\newton} = \unit[per-mode = fraction]{
  \kilo\gram\metre\per\second\squared}$ or
$\unit{\N} = \unit[per-mode = symbol]{
  \kg\m\per\s\tothe{2}}$?
\end{example}
The commands \csi{gram}, \csi{kilo}, \csi{per} are rather self explanatory. As you
can see we have also used the \cargv{per-mode} option to influence the unit
style. While the command \csi{tothe} typesets arbitrary superscripts, the
command \csi{of} typesets arbitrary subscripts, known as qualifiers.
\begin{example}
\unit{\kg\of{mol}},
\unit{\bel\of{i}}
\end{example}

Note that the \csi{per} command only works on the next unit. If we want it to
apply to all following units we may use \cargv{sticky-per} option.
\begin{example}[examplewidth=0.7\linewidth, vertical_mode]
The unit of thermal conductivity is
\unit{\watt\per\metre\per\kelvin}
or equivalently
\unit[sticky-per]{\m\kg\per\s\cubed\K}. 
\end{example}

Sometimes you may want to make the units use a different colour so they figure more prominently. This can be done using \cargv{unit-color}. Options
\cargv{number-color} and \cargv{color} may be used to colour only the numeric
values or whole quantities. If you want to highlight a single unit in a
compound unit, you may use the \csi{highlight} command.
\begin{example}[examplewidth=0.8\linewidth, vertical_mode]
\qty[unit-color = red   ]{9.81}{\m\per\s\squared},
\qty[number-color = blue]{9.81}{\m\per\s\squared},
\qty[color = green      ]{9.81}{\m\per\s\squared},
\qty{9.81}{\m\per\highlight{orange}\s\squared}
\end{example}

Now let's turn our attention to numbers. The numeric values will always use dot
as a decimal separator, regardless of entered symbol. If you want to use comma
as a decimal separator, change the \cargv{output-decimal-marker} option.
\begin{example}
$\pi \approx \num{3.14159}$ \\
$\pi \approx \num{3,14159}$ \\
$\pi \approx \num[
  output-decimal-marker={,}
]{3.14159}$
\end{example}

The numbers may also be entered using exponent notation. The symbol before
exponent and base may be controlled using \cargv{exponent-product} and
\cargv{exponent-base} options
\begin{example}
$\qty{1}{\tonne} = \qty{1e6}{\g}$ \\
$\qty{1}{\gibi\byte} = \qty[
  exponent-base = 2,
]{1e30}{\byte}$ \\
$\qty{1}{\L} = \qty[
  exponent-product = \cdot,
]{1e-3}{\cubic\m}$
\end{example}

If we want all numbers to be formatted using exponent notation, regardless of
their entered form, we may use \cargv{exponent-mode} option.
\begin{example}
$2^{16} = \num{65536}$ \\
$2^{16} = \num[
  exponent-mode = scientific,
]{65536}$ \\
$2^{16} = \num[
  exponent-mode = engineering,
]{65536}$ \\
$2^{16} = \num[
  exponent-mode = fixed,
]{65.536e3}$ \\
$2^{16} = \num[
  exponent-mode = fixed,
  fixed-exponent = 5,
]{65.536e3}$
\end{example}

In some fields it may be common to write uncertainty next to numbers. This may
also be done in several ways. In order to customise the appearance of
uncertainty use the \cargv{uncertainty-mode} option.
\begin{example}
$M_\oplus = \qty{
  5.9722(6) e24}{\kg}$
  \\ %!hide
$M_\oplus = \qty{
  5.9722 +- 0.0006 e24}{\kg}$
  \\ %!hide
$M_\oplus = \qty{
  5.9722 \pm 0.0006 e24}{\kg}$
  \\ %!hide
$M_\oplus = \qty[
    uncertainty-mode = separate
  ]{5.9722(6) e24}{\kg}$
  \\ %!hide
$M_\oplus = \qty[
  uncertainty-mode = full
]{5.9722(6) e24}{\kg}$
\end{example}

By default \pai{siunitx} typesets the quantities in math mode. This may be
especially jarring if you use different font for the document text. One simple
solution is to set the \cargv{mode} option to \cargv{text}.
% TODO: Add pointer to changing math fonts section when written.
\begin{example}
\setmainfont{Source Sans Pro} %!hide
\qty{1}{\degreeCelsius} is
equal to \qty{1}{\kelvin},
but \qty[
  mode = text,
]{0}{\degreeCelsius} is \qty[
  mode = text,
]{-273.15}{\kelvin}.
Bizarre, isn't it?
\end{example}

The behaviour of the commands may be customised even further. For a full list
of options check out the \pai{siunitx} package documentation.

To avoid repeating the options with every use of commands, use the
\begin{lscommand}
  \csi{sisetup}[options: m]
\end{lscommand}
command. It can be used in the preamble to ensure consistent style throughout
the document, or inside the document when the style needs to be changed just
in a given element, such as a table. These options may be also passed as package
options. \autoref{sistandaloneexa} shows an example usage of the package in
a full document.
\begin{listing}
  \begin{example}[standalone, template=empty, examplewidth=\linewidth,paperwidth=12cm, paperheight=5.5cm, vertical_mode]
\documentclass{article}

\usepackage[paperheight=\height,paperwidth=\width,margin=0.3cm]{geometry} %!hide
\sloppy %!hide
\usepackage{booktabs}
\usepackage[per-mode = fraction, unit-color = red]{siunitx}

\begin{document}
Units are typeset like this: \qty{9.81}{\m\per\s\squared}.
\begin{table}[h]
  \centering
  \sisetup{exponent-mode = fixed, fixed-exponent = 1}
  \begin{tabular}{@{}lr@{}}
    \toprule
    No. & Result (\unit{\kg}) \\
    \midrule
    1   & \num{12.3}          \\ 
    2   & \num{0.3}           \\ 
    3   & \num{1e2}           \\
    \bottomrule
  \end{tabular}
  \caption{Measurement results.
    Here custom options are used.}\label{table}
\end{table}

Now we are back to normal: \qty{3.637e-4}{\m\squared\per\s}.
\end{document}
\end{example}
  \caption{An example of using \pai{siunitx} in a document.}%
  \label{sistandaloneexa}
\end{listing}

\subsection{Other \pai{siunitx} commands}

Besides the basic commands described above \pai{siunitx} also defines several
other useful commands.

Angles are special in that they use base $60$ instead of base ten when
subdividing. The command
\begin{lscommand}
  \csi{ang}[options: o, angle: m]
\end{lscommand}
exists in order to simplify entering them. If they are entered using semicolon
as a separator, then the following numbers are treated as minutes and seconds.
If they are given as a decimal number, they will be displayed as such.
\begin{example}
\ang{10}
\qquad %!hide
\ang{1;2;3}
\qquad %!hide
\ang{;;20} \\
\ang{32.5}
\qquad %!hide
\qty{60}{\degree}
\end{example}

When listing several numbers we may use the
\begin{lscommand}
  \csi{numlist}[options: o, numbers: m]
\end{lscommand}
where \carg{numbers} are delimited by semicolons. This command is context aware
which means it will produce correct results when used with \pai{polyglossia}.
\begin{example}
\numlist{1;2;3;4}

\begin{german}
  \numlist{1;2;3;4}
\end{german}
\end{example}

The package contains also dedicated commands for dealing with products and
ranges of numbers. The numbers in product should be delimited with the \verb|x|
letter.
\begin{example}
Pick a number from
range \numrange{1}{10}. \\
\numproduct{2x5} is $10$. \\
\begin{german}
  \numrange{1}{10}
\end{german}
\end{example}

All these commands also have quantity versions.
\begin{example}
Obtained results:
\qtylist{2;5;7}{\L}.\\
Acceptable range is
\qtyrange{1}{10}{\kg}. \\
This area is
\qtyproduct{2x5}{\metre}.
\end{example}

If we are dealing with quantum mechanics then complex numbers may be useful.
To typeset them use \csi{complexnum} and \csi{complexqty}. They can be entered in
both Cartesian form and polar coordinates.

\begin{example}[examplewidth=0.5\linewidth]
The conjugate of
\complexnum{2+3i} is
\complexnum{2-3i}
which is approximately
\complexnum{3.6056:-56.310}. \\
Why is my scale showing my
weight is
\complexqty{65+i21}{\kg}?
\end{example}

Sometimes the required unit that we want to use is missing. For example
throughout this book the unit of typographical point is used when talking about
font sizes. To define it we may use the
\begin{lscommand}
  \csi{DeclareSIUnit}[options:o, unit:m, symbol:m]
\end{lscommand}
command. The \carg{unit} is the macro we will use in the interpreted mode,
while the \carg{symbol} is the typeset symbol. The \carg{options} allows us to
define default options concerning, for example, the spacing of the unit in
quantities.
\begin{example}
\DeclareSIUnit{\pt}{pt}
The default font size
in \LaTeX{} is \qty{10}{\pt}.
\end{example}

This command may also be used when we want to adjust the appearance of
predefined unit. For example, the default litre is typeset using uppercase
\enquote*{L} and you may want to change it to use lowercase \enquote*{l}
instead.
\begin{example}
Litre before redefining:
\unit{\L}. \\
\DeclareSIUnit{\litre}{l}
Litre after redefining:
\unit{\L}.
\end{example}

Similarly the commands
\begin{lscommand}
  \csi{DeclareSIPrefix}    \\
  \csi{DeclareSIPower}     \\
  \csi{DeclareSIQualifier}
\end{lscommand}
allow definition of unit-related macros in case additional are needed.
\begin{example}[examplewidth=0.8\linewidth, vertical_mode]
\DeclareSIUnit{\pt}{pt}
\DeclareSIPower\quartic\tothefourth{4}
\DeclareSIPrefix\decakilo{dk}{4}
\DeclareSIQualifier\polymer{pol}

It's over \qty{9000}{\quartic\decakilo\pt\polymer}!
\end{example}

\subsection{Table columns with numbers}\label{sec:sitables}\index{decimal
  alignment}

When typesetting tables which contain numeric data it is often useful to align
them along the decimal point, so they can be compared easily. The \pai{siunitx}
package adds the special column specifier \cargv{S} for this purpose to the
\ei{tabular} environment. Non numeric data must be surrounded by curly brackets
in such columns.
\begin{listing}
  \begin{example}[examplewidth=0.7\linewidth, vertical_mode]
\begin{tabular}{@{}lS@{}}
  \toprule
  Day       & {Candy eaten (\unit{\g})} \\
  \midrule
  Monday    & .3011                     \\
  Tuesday   & 54.86                     \\
  Wednesday & 1000.9722                 \\
  Thursday  & -1000.9722                \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{A simple example of using \pai{siunitx}'s \cargv{S} column
    specification.}
\end{listing}

When presenting numeric data, such as above, it is good to remember the
following two rules
\begin{itemize}
  \item Never drop the leading zero before the decimal point.
  \item If the unit is the same in all cells put it in the heading.
\end{itemize}
All the numbers in \cargv{S} columns are automatically parsed by \pai{siunitx},
which means that if we use it, the first rule will be enforced for us.

In order to influence parsing\slash{}displaying options of a
single column, pass them in square brackets to the column specification. See
\autoref{lst:siunitxS} for an example.
\begin{listing}
  \begin{example}[examplewidth=0.8\linewidth, vertical_mode]
\DeclareSIUnit{\eur}{\euro}
\begin{tabular} {
    @{}l
    S[output-decimal-marker={,},
      per-mode=symbol]@{}
  }
  \toprule
  Candy        & {Price (\unit{\eur\per\kg})} \\
  \midrule
  Chocolate    & 11.30                        \\
  Lollipops    & 15.86                        \\
  Marshmallows & 5.97                         \\
  Golden taffy & 1125.12                      \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An example of using optional parameters in a single \cargv{S}
    column specification.}\label{lst:siunitxS}
\end{listing}

Besides standard options there are also table specific options that can be
passed to the columns. An important one is \cargv{table-format}. By default the
\cargv{S} specifier centres the decimal point leaving equal space to the left
and to the right of it. This leads to a lot of empty space if lengths of
integer and fraction parts are widely different as can be seen in
\autoref{lst:toowide}.
\begin{listing}
  \begin{example}[examplewidth=0.7\linewidth, vertical_mode]
\sisetup{exponent-mode = fixed}
\begin{tabular} {@{}SS@{}}
  \toprule
  {\unit{\ug}} & {\unit{\kg}} \\
  \midrule
  1 & 1e-9 \\
  0.2 & 2e-10 \\
  35 & 35e-8 \\
  -100 & -1e-7 \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An anti-example of using \pai{siunitx}'s \cargv{S} column
    specification without setting the \cargv{table-format}.}\label{lst:toowide}
\end{listing}
We can then use
\cargv{table-format} to instruct \LaTeX{} how much space should be reserved
before and after dot. For example \cargv{6.2} means that it should reserve
space for 6 digits before the decimal point, and for two after. The format may
also contain information about signs, exponents or text around numbers. See
\autoref{lst:tableformat} for an example.
\begin{listing}
  \begin{example}[examplewidth=0.7\linewidth, vertical_mode]
\sisetup{exponent-mode = fixed}
\begin{tabular} {
    @{}
    S[table-format = +3.1]
    S[table-format = +1.10]
    @{}
  }
  \toprule
  \multicolumn{2}{c}{Weight} \\
  \midrule
  {\unit{\ug}} & {\unit{\kg}} \\
  \midrule
  1 & 1e-9 \\
  0.2 & 2e-10 \\
  35 & 35e-8 \\
  -100 & -1e-7 \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An example of using \pai{siunitx}'s \cargv{S} column
    specification with the \cargv{table-format} key.}\label{lst:tableformat}
\end{listing}

By default numbers and text within the \cargv{S} columns and centred. If you
want to change the alignment use the \cargv{table-number-alignment} and
\cargv{table-text-alignment} options. See \autoref{lst:salignment} for an example.
\begin{listing}
  \begin{example}[examplewidth=0.7\linewidth, vertical_mode]
\begin{tabular} {
    @{}
    S[
      table-format = 2.1(1.1),
      table-number-alignment = left,
      uncertainty-mode = separate,
    ]
    S[
      table-format = 2.2e2{ big!},
      table-text-alignment = right,
    ]
    @{}
  }
  \toprule
  {Confidence (\unit{\percent})}
    & {Value} \\
  \midrule
  57.1(2) & 10e2 \\
  25.3(0) & 2e-1 \\
  0(0.1)  & 99.99e99{ big!} \\
  92(1)      & 7.2e10 \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An example of aligning text and numbers inside the \pai{siunitx}'s \cargv{S} column.}\label{lst:salignment}
\end{listing}
The numbers may also be aligned inside a \csi{multicol} or \csi{multirow},
using the \csi{tablenum} command as seen in \autoref{lst:tablenum}.
\begin{listing}
  \begin{example}[examplewidth=0.7\linewidth, vertical_mode]
\sisetup{table-format = 4.4e1}
\begin{tabular}{@{}lr@{}}
  \toprule
  Candy     & Friend                         \\
  \midrule
  Chocolate & Peter                          \\
  Lollipop  & Jane                           \\
  \multicolumn{2}{c}{\tablenum{12,34 e0}}    \\
  \multicolumn{2}{c}{\tablenum{333.5567 e1}} \\
  \multicolumn{2}{c}{\tablenum{4563.21 e2}}  \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An example of using the \csi{tablenum} command.}\label{lst:tablenum}
\end{listing}

If you don't want the decimal alignment but still would like to have
numbers in columns formatted by \pai{siunitx}, change the
\cargv{table-alignment-mode} to \cargv{none}.
\begin{example}[examplewidth=0.45\linewidth]
\sisetup{
  table-alignment-mode = none,
  output-decimal-marker = {,},
  unit-color = red,
}
\begin{tabular}{@{}cS@{}}
  \toprule
  Variable & {Value} \\
  \midrule
  foo & 101.892 \\
  bar & 2e-1 \\
  baz & \qty{2.1}{\kg}  \\
  \bottomrule
\end{tabular}
\end{example}

\section{Arrays and Matrices}%
\label{sec:arraymat}

To typeset \emph{arrays}, use the \ei{array} environment. It works
in a similar way to the \ei{tabular} environment. The \csi{\bs} command is
used to break the lines:
\begin{example}
  \begin{equation*}
    \mathbf{X} = \left( 
      \begin{array}{ccc}
        x_1 & x_2 & \ldots \\
        x_3 & x_4 & \ldots \\
        \vdots & \vdots & \ddots
      \end{array} \right)
  \end{equation*}
\end{example}

The \ei{array} environment can also be used to typeset \wi{piecewise function}s by
using a ``\cargv{.}'' as an invisible \csi{right} delimiter:
\begin{example}
\begin{equation*}
  |x| = \left\{
    \begin{array}{rl}
      -x & \text{if } x < 0,\\
      0 & \text{if } x = 0,\\
      x & \text{if } x > 0.
    \end{array} \right.
\end{equation*}
\end{example}
The \ei{cases} environment from \pai{amsmath} simplifies
the syntax, so it is worth a look:
\begin{example}
  \begin{equation*}
    |x| = 
    \begin{cases}
      -x & \text{if } x < 0,\\
      0 & \text{if } x = 0,\\
      x & \text{if } x > 0.
    \end{cases} 
\end{equation*}
\end{example}

Matrices\index{matrix} can be typeset by \ei{array}, but
\pai{amsmath} provides a better solution using the different \ei{matrix}
environments. There are six versions with different delimiters: \ei{matrix}
(none), \ei{pmatrix} $($, \ei{bmatrix} $[$, \ei{Bmatrix} $\{$, \ei{vmatrix} $\vert$ and
\ei{Vmatrix} $\Vert$. You don't have to specify the number of columns as with
\ei{array}. The maximum number is 10, but it is customisable (though it is not
very often you need 10 columns!):
\begin{example}
\begin{equation*}
  \begin{matrix} 
    1 & 2 \\
    3 & 4 
  \end{matrix} \qquad
  \begin{bmatrix} 
    p_{11} & p_{12} & \ldots 
    & p_{1n} \\
    p_{21} & p_{22} & \ldots 
    & p_{2n} \\
    \vdots & \vdots & \ddots 
    & \vdots \\
    p_{m1} & p_{m2} & \ldots 
    & p_{mn} 
  \end{bmatrix}
\end{equation*}
\end{example}

\section{Spacing in Math Mode}\label{sec:math-spacing}%
\index{math spacing}
If the spacing within formulae chosen by \LaTeX{}
is not satisfactory, it can be adjusted by inserting special spacing
commands: \csi{,} for $\frac{3}{18}\:\textrm{quad}$
(\demowidth{0.166em}), \csi{:} for $\frac{4}{18}\: \textrm{quad}$
(\demowidth{0.222em}) and \csi{;} for $\frac{5}{18}\: \textrm{quad}$
(\demowidth{0.277em}).  The escaped space character \csi{\textvisiblespace}
generates a medium sized space comparable to the interword spacing and
\csi{quad} (\demowidth{1em}) and \csi{qquad} (\demowidth{2em}) produce
large spaces. The size of a \csi{quad} corresponds to the width of the
character `M' of the current font. \csi{!} produces a
negative space of $-\frac{3}{18}\:\textrm{quad}$
($-$\demowidth{0.166em}).

\begin{example}
\begin{equation*}
  \int_1^2 \ln x \mathrm{d}x 
  \qquad
  \int_1^2 \ln x \,\mathrm{d}x
\end{equation*}
\end{example}

Note that `d' in the differential is conventionally set in roman.
In the next example, we define a new command \csi{ud} (upright d) which produces
``$\,\mathrm{d}$'' (notice the spacing \demowidth{0.166em} before the
$\text{d}$), so we don't have to write it every time. The \csi{NewDocumentCommand} is
placed in the preamble.  More on
\csi{NewDocumentCommand} in \autoref{sec:new_commands} on \autopageref{sec:new_commands}.
\begin{example}[examplewidth=0.35\linewidth]
\NewDocumentCommand{\ud}{}{\,\mathrm{d}}

\begin{equation*}
 \int_a^b f(x)\ud x 
\end{equation*}
\end{example}

If you want to typeset multiple integrals, you'll discover that the spacing
between the integrals is too wide. You can correct it using \csi{!}, but
\pai{amsmath} provides an easier way for fine-tuning
the spacing, namely the \csi{iint}, \csi{iiint}, \csi{iiiint}, and \csi{idotsint}
commands.

\begin{example}[examplewidth=0.35\linewidth]
\NewDocumentCommand{\ud}{}{\,\mathrm{d}}

\begin{IEEEeqnarray*}{c}
  \int\int f(x)g(y) 
                  \ud x \ud y \\
  \int\!\!\!\int 
         f(x)g(y) \ud x \ud y \\
  \iint f(x)g(y)  \ud x \ud y 
\end{IEEEeqnarray*}
\end{example}

For further details see~\cite{amstestmath} or Chapter~8 of \companion{}.

\subsection{Phantoms}

When vertically aligning text using \ai{\^} and \ai{\_} \LaTeX{} is sometimes
just a little too helpful. Using the \csi{phantom} command you can
reserve space for characters that do not show up in the final output.
The easiest way to understand this is to look at an example:
\begin{example}
\begin{equation*}
{}^{14}_{6}\text{C}
\qquad \text{versus} \qquad
{}^{14}_{\phantom{1}6}\text{C}
\end{equation*}
\end{example}
If you want to typeset a lot of isotopes as in the example, the \pai{mhchem}
package is very useful for typesetting isotopes and chemical formulae too.

\section{Fiddling with the Math Fonts}\label{sec:fontsz}
Different math fonts are listed on \autoref{mathalpha} on \autopageref{mathalpha}.
\begin{example}
 $\Re \qquad
  \mathcal{R} \qquad
  \mathfrak{R} \qquad
  \mathbb{R} \qquad $  
\end{example}
The last two require \pai{amssymb} or \pai{amsfonts}.

Sometimes you need to tell \LaTeX{} the correct font
size. In math mode, this is set with the following four commands:
\begin{lscommand}
  \csi{displaystyle}~($\displaystyle 123$)\\
  \csi{textstyle}~($\textstyle 123$)\\
  \csi{scriptstyle}~($\scriptstyle 123$)\\
  \csi{scriptscriptstyle}~($\scriptscriptstyle 123$)
\end{lscommand}

If $\sum$ is placed in a fraction, it'll be typeset in text style unless you tell
\LaTeX{} otherwise:
\begin{example}[examplewidth=0.55\linewidth]
\begin{equation*}
 P = \frac{\displaystyle{ 
   \sum_{i=1}^n (x_i- x)
   (y_i- y)}} 
   {\displaystyle{\left[
   \sum_{i=1}^n(x_i-x)^2
   \sum_{i=1}^n(y_i- y)^2
   \right]^{1/2}}}
\end{equation*}    
\end{example}
Changing styles generally affects the way big operators and limits are displayed.

% This is not a math accent, and no maths book would be set this way.
% mathop gets the spacing right.

\subsection{Bold Symbols}%
\index{bold symbols}

It is quite difficult to get bold symbols in \LaTeX{}; this is
probably intentional as amateur typesetters tend to overuse them.  The
font change command \csi{mathbf} gives bold letters, but these are
roman (upright) whereas mathematical symbols are normally italic, and
furthermore it doesn't work on lower case Greek letters.
There is a \csi{boldmath} command, but \emph{this can only be used
  outside math mode}. It works for symbols too, though:
\begin{example}
$\mu, M \qquad 
\mathbf{\mu}, \mathbf{M}$
\qquad \boldmath{$\mu, M$}
\end{example}

The package \pai{amsbsy} (included by \pai{amsmath}) as well as the
package \pai{bm} from the \pai{tools} bundle make this much easier as they include
a \csi{boldsymbol} command:

\begin{example}
$\mu, M$
$\boldsymbol{\mu}
  \boldsymbol{M}$
\end{example}

\section{Theorems, Lemmas, \ldots}

When writing mathematical documents, you probably need a way to
typeset ``Lemmas'', ``Definitions'', ``Axioms'' and similar
structures.
\begin{lscommand}
  \csi{newtheorem}[name:m, counter:o, text:m, section:o]
\end{lscommand}
The \carg{name} argument is a short keyword used to identify the
``theorem''. With the \carg{text} argument you define the actual name
of the ``theorem'', which will be printed in the final document.

The arguments in square brackets are optional. They are both used to
specify the numbering used on the ``theorem''. Use  the \carg{counter}
argument to specify the \carg{name} of a previously declared
``theorem''. The new ``theorem'' will then be numbered in the same
sequence.  The \carg{section} argument allows you to specify the
sectional unit within which the ``theorem'' should get its numbers.

After executing the \csi{newtheorem} command in the preamble of your
document, you can use the following command within the document.
\begin{code}
\verb|\begin{|\emph{name}\verb|}[|\emph{text}\verb|]|\\
This is my interesting theorem\\
\verb|\end{|\emph{name}\verb|}|     
\end{code}

The \pai{amsthm} package (part of \hologo{AmSLaTeX}) provides the
\begin{lscommand}
  \csi{theoremstyle}[style: m]
\end{lscommand}
command which lets you define what the theorem is all about by picking
from three predefined styles: \cargv{definition} (fat title, roman body),
\cargv{plain} (fat title, italic body) or \cargv{remark} (italic
title, roman body).

This should be enough theory. The following examples should
remove any remaining doubt, and make it clear that the
\csi{newtheorem} command is way too complex to understand.

First define the theorems:

\begin{minted}{latex}
\theoremstyle{definition} \newtheorem{law}{Law}
\theoremstyle{plain}      \newtheorem{jury}[law]{Jury}
\theoremstyle{remark}     \newtheorem*{marg}{Margaret}
\end{minted}

\begin{example}
\begin{law}\label{law:box}
Don't hide in the witness box
\end{law}
\begin{jury}[The Twelve]
It could be you! So beware and
see law~\ref{law:box}.\end{jury}
\begin{jury}
You will disregard the last
statement.\end{jury}
\begin{marg}No, No, No\end{marg}
\begin{marg}Denis!\end{marg}
\end{example}

The ``Jury'' theorem uses the same counter as the ``Law''
theorem, so it gets a number that is in sequence with
the other ``Laws''. The argument in square brackets is used to specify
a title or something similar for the theorem.
\begin{example}[examplewidth=0.45\linewidth]
%!showbegin !hide
\newtheorem{mur}{Murphy}[section]
%!showend !hide

\begin{mur} If there are two or 
more ways to do something, and 
one of those ways can result in
a catastrophe, then someone 
will do it.\end{mur}
\end{example}

The ``Murphy'' theorem gets a number that is linked to the number of
the current section. You could also use another unit, for example chapter or
subsection.

If you want to customise your theorems down to the last dot, the
\pai{ntheorem} package offers a plethora of options.

\subsection{Proofs and End-of-Proof Symbol}\label{sec:putting-qed-right}

The \pai{amsthm} package also provides the \ei{proof} environment.

\begin{example}
\begin{proof}
 Trivial, use
 \begin{equation*}
   E=mc^2.
 \end{equation*}
\end{proof}
\end{example}

With the command \csi{qedhere} you can move the `end of proof' symbol
around for situations where it would end up alone on a line.

\begin{example}
\begin{proof}
 Trivial, use
 \begin{equation*}
   E=mc^2. \qedhere
 \end{equation*}
\end{proof}
\end{example}

Unfortunately, this correction does not work for \ei{IEEEeqnarray}:
\begin{example}
\begin{proof}
  This is a proof that ends
  with an equation array:
  \begin{IEEEeqnarray*}{rCl}
    a & = & b + c \\
    & = & d + e. \qedhere
  \end{IEEEeqnarray*}  
\end{proof}
\end{example}
\noindent
The reason for this is the internal structure of \ei{IEEEeqnarray}:
it always puts two invisible columns at both sides of the array that
only contain a stretchable space. By this \ei{IEEEeqnarray} ensures
that the equation array is horizontally centred. The
\csi{qedhere} command should actually be put \emph{outside} this
stretchable space, but this does not happen as these columns are
invisible to the user.

There is a very simple remedy. Define the stretching
explicitly!
\begin{example}
\begin{proof}
  This is a proof that ends
  with an equation array:
  \begin{IEEEeqnarray*}{+rCl+x*}
    a & = & b + c \\
    & = & d + e. & \qedhere
  \end{IEEEeqnarray*}  
\end{proof}
\end{example}
\noindent
Note that the \cargv{+} in \verb|{+rCl+x*}| denotes stretchable spaces, one
on the left of the equations (which, if not specified, will be done
automatically by \ei{IEEEeqnarray}!) and one on the right of the
equations. But now on the right, \emph{after} the stretching column,
we add an empty column \cargv{x}. This column will only be needed on
the last line if the \csi{qedhere} command is put
there. Finally, we specify a \cargv{*}. This is a null-space that
prevents \ei{IEEEeqnarray} from adding another unwanted \cargv{+}-space!

In the case of equation numbering, there is a similar problem. Comparing
\begin{example}
\begin{proof}
  This is a proof that ends
  with a numbered equation:
  \begin{equation}
    a = b + c.
  \end{equation}
\end{proof}
\end{example}
\noindent
with
\begin{example}
\begin{proof}
  This is a proof that ends
  with a numbered equation:
  \begin{equation}
    a = b + c. \qedhere
  \end{equation}
\end{proof}
\end{example}
\noindent
you notice that in the (correct) second version the $\Box$ is much
closer to the equation than in the first version.

Similarly, the correct way of putting the QED-symbol at the end of an
equation array is as follows:
\begin{example}
\begin{proof}
  This is a proof that ends
  with an equation array:
  \begin{IEEEeqnarray}{+rCl+x*}
    a & = & b + c \\
    & = & d + e. \\
    &&& \qedhere\nonumber
  \end{IEEEeqnarray}  
\end{proof}
\end{example}
\noindent
which contrasts with
\begin{example}
\begin{proof}
  This is a proof that ends
  with an equation array:
  \begin{IEEEeqnarray}{rCl}
    a & = & b + c \\
    & = & d + e.
  \end{IEEEeqnarray}  
\end{proof}
\end{example}

%

% Local Variables:
% TeX-master: "lshort"
% mode: latex
% mode: flyspell
% End:
